<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çš®è†šã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ï½œKINS WITH Animal Hospital</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=Outfit:wght@300;400;500;600;700;800;900&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  :root {
    --primary: #C55E56;
    --dark: #5A3C37;
    --mid: #965D57;
    --accent: #CDA094;
    --light: #EBD5CD;
    --bg: #F7F6F4;
    --white: #FFFFFF;
    --text: #3A2E2B;
    --text-sub: #8C7A74;
    --border: #E8DDD8;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100dvh;
    overflow-x: hidden;
  }

  /* â”€â”€â”€ Utility â”€â”€â”€ */
  .hidden { display: none !important; }

  /* â”€â”€â”€ Layout Shell â”€â”€â”€ */
  .app {
    max-width: 480px;
    margin: 0 auto;
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
  }

  /* â”€â”€â”€ Header â”€â”€â”€ */
  .app-header {
    padding: 20px 24px 0;
    text-align: center;
  }
  .app-header .brand {
    font-family: 'Outfit', sans-serif;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 4px;
    color: var(--primary);
    text-transform: uppercase;
  }

  /* â”€â”€â”€ Paw Progress â”€â”€â”€ */
  .progress-wrap {
    padding: 16px 24px 0;
  }
  .paw-track {
    display: flex;
    justify-content: center;
    gap: 6px;
  }
  .paw {
    font-size: 16px;
    opacity: 0.2;
    transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    filter: grayscale(1);
  }
  .paw.filled {
    opacity: 1;
    filter: grayscale(0);
    animation: pawPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  @keyframes pawPop {
    0% { transform: scale(0.5); opacity: 0; }
    60% { transform: scale(1.3); }
    100% { transform: scale(1); opacity: 1; }
  }
  .paw-done {
    display: none;
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    color: var(--primary);
    text-align: center;
    margin-top: 6px;
    font-weight: 600;
    letter-spacing: 0.5px;
  }
  .paw-done.show {
    display: block;
    animation: fadeIn 0.35s ease;
  }

  /* â”€â”€â”€ Particles â”€â”€â”€ */
  .particle-container {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 9999;
    overflow: hidden;
  }
  .particle {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    animation: particleFly var(--duration) cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }
  @keyframes particleFly {
    0% {
      transform: translate(0, 0) scale(1) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: translate(var(--tx), var(--ty)) scale(0) rotate(var(--rot));
      opacity: 0;
    }
  }

  /* â”€â”€â”€ Screen Container â”€â”€â”€ */
  .screen {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 24px;
    animation: fadeIn 0.35s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* â”€â”€â”€ Intro Screen â”€â”€â”€ */
  .intro {
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 40px 24px;
  }

  .intro-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--light);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    margin: 0 auto 28px;
  }

  .intro h1 {
    font-size: 22px;
    font-weight: 900;
    line-height: 1.5;
    margin-bottom: 16px;
    color: var(--dark);
  }

  .intro p {
    font-size: 14px;
    line-height: 1.9;
    color: var(--text-sub);
    margin-bottom: 8px;
  }

  .intro .note {
    font-size: 12px;
    color: var(--accent);
    margin-top: 20px;
    line-height: 1.7;
  }

  /* â”€â”€â”€ Buttons â”€â”€â”€ */
  .btn-primary {
    display: block;
    width: 100%;
    max-width: 320px;
    margin: 32px auto 0;
    padding: 16px;
    background: var(--primary);
    color: var(--white);
    border: none;
    border-radius: 8px;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.2s, transform 0.15s;
  }
  .btn-primary:active {
    transform: scale(0.97);
  }
  .btn-primary:hover {
    background: var(--mid);
  }

  .btn-secondary {
    display: block;
    width: 100%;
    max-width: 320px;
    margin: 12px auto 0;
    padding: 14px;
    background: transparent;
    color: var(--text-sub);
    border: 1.5px solid var(--border);
    border-radius: 8px;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: border-color 0.2s;
  }
  .btn-secondary:hover {
    border-color: var(--accent);
  }

  /* â”€â”€â”€ Question Screen â”€â”€â”€ */
  .question-screen {
    justify-content: center;
  }

  .q-category {
    font-family: 'Outfit', sans-serif;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--primary);
    margin-bottom: 12px;
  }

  .q-title {
    font-size: 20px;
    font-weight: 900;
    line-height: 1.6;
    color: var(--dark);
    margin-bottom: 12px;
  }

  .q-desc {
    font-size: 13px;
    line-height: 1.8;
    color: var(--text-sub);
    margin-bottom: 32px;
  }

  .q-hint {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px 16px;
    margin-bottom: 32px;
  }

  .q-hint-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--accent);
    letter-spacing: 1px;
    margin-bottom: 6px;
  }

  .q-hint p {
    font-size: 12px;
    line-height: 1.8;
    color: var(--text-sub);
  }

  /* Answer Buttons */
  .answer-group {
    display: flex;
    gap: 12px;
    max-width: 320px;
    margin: 0 auto;
    width: 100%;
  }

  .answer-btn {
    flex: 1;
    padding: 16px;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    background: var(--white);
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--text);
  }

  .answer-btn:hover {
    border-color: var(--accent);
  }

  .answer-btn.yes:hover {
    border-color: var(--primary);
    background: rgba(197,94,86,0.05);
    color: var(--primary);
  }

  .answer-btn.no:hover {
    border-color: var(--text-sub);
  }

  .answer-btn:active {
    transform: scale(0.96);
  }

  /* â”€â”€â”€ Input Screen â”€â”€â”€ */
  .input-screen {
    justify-content: center;
  }

  .input-screen h2 {
    font-size: 20px;
    font-weight: 900;
    color: var(--dark);
    margin-bottom: 8px;
    line-height: 1.5;
  }

  .input-screen .sub {
    font-size: 13px;
    color: var(--text-sub);
    line-height: 1.8;
    margin-bottom: 28px;
  }

  .field-label {
    font-size: 12px;
    font-weight: 700;
    color: var(--text-sub);
    margin-bottom: 8px;
  }

  .text-input {
    width: 100%;
    padding: 14px 16px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    background: var(--white);
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 16px;
    color: var(--text);
    outline: none;
    transition: border-color 0.2s;
    margin-bottom: 24px;
  }
  .text-input:focus {
    border-color: var(--primary);
  }
  .text-input::placeholder {
    color: var(--accent);
  }

  /* Photo Upload */
  .photo-upload-area {
    width: 100%;
    aspect-ratio: 1;
    max-width: 240px;
    margin: 0 auto 8px;
    border: 2px dashed var(--border);
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
    overflow: hidden;
    position: relative;
  }

  .photo-upload-area:hover {
    border-color: var(--accent);
    background: rgba(205,160,148,0.05);
  }

  .photo-upload-area.has-photo {
    border-style: solid;
    border-color: var(--primary);
  }

  .photo-upload-area img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    inset: 0;
  }

  .upload-placeholder {
    text-align: center;
    color: var(--accent);
  }

  .upload-placeholder .icon {
    font-size: 32px;
    margin-bottom: 8px;
  }

  .upload-placeholder p {
    font-size: 12px;
    line-height: 1.6;
  }

  .photo-skip {
    text-align: center;
    margin-top: 4px;
    margin-bottom: 20px;
  }

  .photo-skip span {
    font-size: 11px;
    color: var(--accent);
  }

  #photoInput {
    display: none;
  }

  /* â”€â”€â”€ Result Screen â”€â”€â”€ */
  .result-screen {
    align-items: center;
    padding: 24px 16px 40px;
  }

  .result-screen h2 {
    font-size: 18px;
    font-weight: 900;
    color: var(--dark);
    margin-bottom: 4px;
    text-align: center;
  }

  .result-sub {
    font-size: 12px;
    color: var(--text-sub);
    margin-bottom: 24px;
    text-align: center;
  }

  .card-container {
    display: flex;
    flex-direction: column;
    gap: 24px;
    width: 100%;
    align-items: center;
    margin-bottom: 28px;
  }

  .card-label {
    font-family: 'Outfit', sans-serif;
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--text-sub);
    margin-bottom: 8px;
    text-align: center;
  }

  /* â”€â”€â”€ Generated Cards â”€â”€â”€ */

  /* FRONT CARD */
  .gen-front {
    width: 340px;
    height: 430px;
    border-radius: 8px;
    position: relative;
    overflow: hidden;
    background: var(--primary);
    box-shadow: 0 12px 40px rgba(197,94,86,0.25);
  }

  .gen-front .noise {
    position: absolute;
    inset: 0;
    background: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='paper'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='5' stitchTiles='stitch' seed='2'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23paper)' opacity='0.06'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1;
  }

  .gen-front .paper-texture {
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse at 20% 50%, rgba(255,255,255,0.04) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 20%, rgba(255,255,255,0.03) 0%, transparent 40%),
      radial-gradient(ellipse at 50% 80%, rgba(0,0,0,0.03) 0%, transparent 45%);
    pointer-events: none;
    z-index: 1;
  }

  .gen-front .gradient-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(170deg, rgba(197,94,86,0) 30%, rgba(80,30,27,0.6) 100%);
    z-index: 1;
    pointer-events: none;
  }

  .gen-front .inner {
    position: relative;
    z-index: 2;
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 24px;
  }

  .gen-front .top-row {
    text-align: left;
  }

  .gen-front .card-brand {
    font-family: 'Outfit', sans-serif;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 4px;
    color: rgba(255,255,255,0.45);
    text-transform: uppercase;
  }

  .gen-front .photo-area {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .gen-front .photo-circle {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    background: rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 56px;
    border: 3px solid rgba(255,255,255,0.1);
    overflow: hidden;
  }

  .gen-front .photo-circle img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .gen-front .bottom-content {
    text-align: center;
  }

  .gen-front .card-pet-name {
    font-size: 38px;
    font-weight: 900;
    color: #fff;
    line-height: 1;
    letter-spacing: -0.02em;
  }

  /* BACK CARD */
  .gen-back {
    width: 340px;
    min-height: 430px;
    border-radius: 8px;
    position: relative;
    overflow: hidden;
    background: #FAFAF6;
    box-shadow: 0 8px 32px rgba(0,0,0,0.07);
  }

  .gen-back .accent-bar {
    height: 4px;
    background: var(--primary);
  }

  .gen-back .inner {
    padding: 20px 24px;
  }

  .gen-back .back-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
    padding-bottom: 10px;
    border-bottom: 1px solid #EDEDEA;
  }

  .gen-back .back-brand {
    font-family: 'Outfit', sans-serif;
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 3px;
    color: var(--primary);
    text-transform: uppercase;
  }

  .gen-back .back-type {
    font-size: 10px;
    font-weight: 500;
    color: #BBB;
    letter-spacing: 1px;
  }

  .gen-back .pet-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 14px;
  }

  .gen-back .pet-photo-sm {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #EFEFE8;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
    overflow: hidden;
  }

  .gen-back .pet-photo-sm img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .gen-back .pet-detail { flex: 1; }

  .gen-back .pet-name-sm {
    font-size: 15px;
    font-weight: 900;
    color: #1A1A1A;
    line-height: 1;
  }

  .gen-back .pet-suffix-sm {
    font-size: 10px;
    color: #BBB;
    margin-top: 3px;
  }

  .gen-back .check-date-sm {
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    color: #CCC;
    text-align: right;
  }

  .gen-back .checklist-label {
    font-size: 10px;
    font-weight: 700;
    color: #BBB;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 8px;
    margin-top: 6px;
  }

  .gen-back .check-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    border-bottom: 1px solid #F0F0EC;
  }
  .gen-back .check-item:last-child {
    border-bottom: none;
  }

  .gen-back .check-icon {
    width: 18px;
    height: 18px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-size: 10px;
  }

  .gen-back .check-icon.hit {
    background: var(--primary);
    color: #fff;
  }

  .gen-back .check-icon.clear {
    background: #EDEDEA;
    color: #CCC;
  }

  .gen-back .check-text {
    font-size: 12px;
    color: #555;
    line-height: 1.4;
  }

  .gen-back .check-text.dimmed {
    color: #CCC;
  }

  /* All Clear */
  .gen-back .all-clear {
    text-align: center;
    padding: 24px 0;
  }

  .gen-back .all-clear-check {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--primary);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    margin: 0 auto 10px;
  }

  .gen-back .all-clear-text {
    font-size: 13px;
    font-weight: 500;
    color: #888;
    line-height: 1.7;
  }

  .gen-back .back-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 14px;
    padding-top: 10px;
    border-top: 1px solid #EDEDEA;
  }

  .gen-back .footer-text {
    font-size: 9px;
    color: #CCC;
    letter-spacing: 0.5px;
  }

  /* Download Buttons */
  .download-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
    max-width: 340px;
    margin-bottom: 16px;
  }

  .dl-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 14px;
    border-radius: 8px;
    border: none;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .dl-btn.front-dl {
    background: var(--primary);
    color: var(--white);
  }
  .dl-btn.front-dl:hover { background: var(--mid); }

  .dl-btn.back-dl {
    background: var(--white);
    color: var(--text);
    border: 1.5px solid var(--border);
  }
  .dl-btn.back-dl:hover { border-color: var(--accent); }

  .dl-btn:active { transform: scale(0.97); }

  .restart-link {
    font-size: 12px;
    color: var(--accent);
    text-decoration: none;
    cursor: pointer;
    margin-top: 12px;
  }
  .restart-link:hover {
    color: var(--mid);
  }

  /* â”€â”€â”€ Message area â”€â”€â”€ */
  .result-message {
    text-align: center;
    max-width: 340px;
    margin-bottom: 24px;
    padding: 16px 20px;
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 8px;
  }

  .result-message p {
    font-size: 13px;
    line-height: 1.8;
    color: var(--text-sub);
  }

  /* â”€â”€â”€ Responsive â”€â”€â”€ */
  @media (max-width: 400px) {
    .gen-front, .gen-back {
      width: 300px;
      min-height: auto;
    }
    .gen-front { height: 380px; }
    .gen-front .card-pet-name { font-size: 32px; }
    .gen-front .photo-circle { width: 130px; height: 130px; }
    .download-group { max-width: 300px; }
  }
</style>
</head>
<body>

<div class="app">

  <!-- Header -->
  <div class="app-header">
    <div class="brand">KINS WITH</div>
  </div>

  <!-- Progress -->
  <div class="progress-wrap hidden" id="progressWrap">
    <div class="paw-track" id="pawTrack">
      <span class="paw">ğŸ¾</span>
      <span class="paw">ğŸ¾</span>
      <span class="paw">ğŸ¾</span>
      <span class="paw">ğŸ¾</span>
      <span class="paw">ğŸ¾</span>
      <span class="paw">ğŸ¾</span>
      <span class="paw">ğŸ¾</span>
      <span class="paw">ğŸ¾</span>
      <span class="paw">ğŸ¾</span>
      <span class="paw">ğŸ¾</span>
    </div>
    <div class="paw-done" id="pawDone">âœ“ ãƒã‚§ãƒƒã‚¯å®Œäº†</div>
  </div>

  <!-- Particle Layer -->
  <div class="particle-container" id="particleContainer"></div>

  <!-- â•â•â• INTRO â•â•â• -->
  <div class="screen intro" id="screenIntro">
    <div class="intro-icon">ğŸ¾</div>
    <h1>ãŠã†ã¡ã§çš®è†š<br>ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯</h1>
    <p>10å€‹ã®è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ã€<br>ãƒ¯ãƒ³ã¡ã‚ƒã‚“ã®çš®è†šã®æ°—ã«ãªã‚‹ã‚µã‚¤ãƒ³ã‚’<br>ãƒã‚§ãƒƒã‚¯ã§ãã¾ã™ã€‚</p>
    <p>æ‰€è¦æ™‚é–“ï¼šç´„2åˆ†</p>
    <div class="note">â€» ã“ã®çµæœã¯è¨ºæ–­ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>æ°—ã«ãªã‚‹ã‚µã‚¤ãƒ³ãŒã‚ã£ãŸå ´åˆã¯<br>ç£åŒ»å¸«ã«ã”ç›¸è«‡ãã ã•ã„ã€‚</div>
    <button class="btn-primary" onclick="startCheck()">ãƒã‚§ãƒƒã‚¯ã‚’ã¯ã˜ã‚ã‚‹</button>
  </div>

  <!-- â•â•â• QUESTION SCREENS â•â•â• -->
  <div class="screen question-screen hidden" id="screenQuestion">
    <div class="q-category" id="qCategory"></div>
    <div class="q-title" id="qTitle"></div>
    <div class="q-desc" id="qDesc"></div>
    <div class="q-hint hidden" id="qHint">
      <div class="q-hint-label">ãƒã‚§ãƒƒã‚¯ã®ãƒã‚¤ãƒ³ãƒˆ</div>
      <p id="qHintText"></p>
    </div>
    <div class="answer-group">
      <button class="answer-btn yes" onclick="answer(true)">ã‚ã¦ã¯ã¾ã‚‹</button>
      <button class="answer-btn no" onclick="answer(false)">ã‚ã¦ã¯ã¾ã‚‰ãªã„</button>
    </div>
  </div>

  <!-- â•â•â• INPUT SCREEN â•â•â• -->
  <div class="screen input-screen hidden" id="screenInput">
    <h2>æœ€å¾Œã«ã€<br>ã‚«ãƒ¼ãƒ‰ã‚’ä½œã‚Šã¾ã—ã‚‡ã†</h2>
    <div class="sub">ãƒã‚§ãƒƒã‚¯çµæœã‚’ã‹ã‚ã„ã„ã‚«ãƒ¼ãƒ‰ã«ã—ã¦<br>ä¿å­˜ã§ãã¾ã™ã€‚</div>

    <div class="field-label">ãƒ¯ãƒ³ã¡ã‚ƒã‚“ã®ãŠåå‰</div>
    <input type="text" class="text-input" id="petNameInput" placeholder="ä¾‹ï¼šãƒãƒŠ" maxlength="10">

    <div class="field-label">ãƒ¯ãƒ³ã¡ã‚ƒã‚“ã®å†™çœŸ</div>
    <div class="photo-upload-area" id="photoArea" onclick="document.getElementById('photoInput').click()">
      <div class="upload-placeholder" id="uploadPlaceholder">
        <div class="icon">ğŸ“·</div>
        <p>ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’é¸æŠ</p>
      </div>
    </div>
    <input type="file" id="photoInput" accept="image/*" onchange="handlePhoto(event)">
    <div class="photo-skip"><span>å†™çœŸãªã—ã§ã‚‚OK</span></div>

    <button class="btn-primary" onclick="generateCards()">ã‚«ãƒ¼ãƒ‰ã‚’ä½œã‚‹</button>
  </div>

  <!-- â•â•â• RESULT SCREEN â•â•â• -->
  <div class="screen result-screen hidden" id="screenResult">
    <h2 id="resultTitle"></h2>
    <div class="result-sub">ãƒã‚§ãƒƒã‚¯å®Œäº†</div>

    <div class="result-message" id="resultMessage"></div>

    <div class="card-container">
      <!-- Front Card -->
      <div>
        <div class="card-label">Share Card</div>
        <div class="gen-front" id="cardFront">
          <div class="noise"></div>
          <div class="paper-texture"></div>
          <div class="gradient-overlay"></div>
          <div class="inner">
            <div class="top-row">
              <div class="card-brand">KINS WITH</div>
            </div>
            <div class="photo-area">
              <div class="photo-circle" id="cardFrontPhoto">ğŸ•</div>
            </div>
            <div class="bottom-content">
              <div class="card-pet-name" id="cardFrontName"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Back Card -->
      <div>
        <div class="card-label">Result Card</div>
        <div class="gen-back" id="cardBack">
          <div class="accent-bar"></div>
          <div class="inner">
            <div class="back-header">
              <div class="back-brand">KINS WITH</div>
              <div class="back-type">çš®è†šã‘ã‚“ã“ã†ã‚«ãƒ¼ãƒ‰</div>
            </div>
            <div class="pet-row">
              <div class="pet-photo-sm" id="cardBackPhoto">ğŸ•</div>
              <div class="pet-detail">
                <div class="pet-name-sm" id="cardBackName"></div>
                <div class="pet-suffix-sm">ã®é£¼ã„ä¸»ã•ã‚“</div>
              </div>
              <div class="check-date-sm" id="cardBackDate"></div>
            </div>
            <div id="cardBackBody"></div>
            <div class="back-footer">
              <div class="footer-text">KINS WITH Animal Hospital</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="download-group">
      <button class="dl-btn front-dl" onclick="shareCard('cardFront', 'share')">ğŸ“¤ å…±æœ‰ç”¨ã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜ãƒ»ã‚·ã‚§ã‚¢</button>
      <button class="dl-btn back-dl" onclick="shareCard('cardBack', 'result')">ğŸ“¤ çµæœã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜ãƒ»ã‚·ã‚§ã‚¢</button>
    </div>

    <a class="restart-link" onclick="restart()">ã‚‚ã†ä¸€åº¦ãƒã‚§ãƒƒã‚¯ã™ã‚‹</a>
  </div>

</div>

<script>
// â”€â”€â”€ Question Data â”€â”€â”€
const questions = [
  {
    category: 'BEHAVIOR',
    title: 'ä½“ã‚’ã‚ˆãæ»ã„ã¦ã„ã¾ã™ã‹ï¼Ÿ',
    desc: 'å‰è¶³ã‚„å¾Œã‚è¶³ã§ä½“ã‚’æ»ãå›æ•°ãŒå¢—ãˆãŸã¨æ„Ÿã˜ã‚‹å ´åˆã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
    hint: '1æ—¥ã«ä½•åº¦ã‚‚æ»ã„ã¦ã„ã‚‹ã€æ»ã„ãŸå¾Œã«èµ¤ããªã£ã¦ã„ã‚‹ã€ãªã©ãŒç›®å®‰ã§ã™ã€‚',
    label: 'ä½“ã‚’ã‚ˆãæ»ã„ã¦ã„ã‚‹'
  },
  {
    category: 'BEHAVIOR',
    title: 'è¶³å…ˆã‚„ãŠè…¹ã‚’èˆã‚ç¶šã‘ã¦ã„ã¾ã™ã‹ï¼Ÿ',
    desc: 'åŒã˜å ´æ‰€ã‚’ç¹°ã‚Šè¿”ã—èˆã‚ã¦ã„ã‚‹å ´åˆã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
    hint: 'è¶³å…ˆãŒèŒ¶è‰²ãå¤‰è‰²ã—ã¦ã„ã‚‹å ´åˆã¯ã€é•·æœŸé–“èˆã‚ç¶šã‘ã¦ã„ã‚‹ã‚µã‚¤ãƒ³ã§ã™ã€‚',
    label: 'è¶³å…ˆã‚„ãŠè…¹ã‚’èˆã‚ç¶šã‘ã‚‹'
  },
  {
    category: 'BEHAVIOR',
    title: 'é¡”ã‚„è€³ã‚’åºŠã‚„å®¶å…·ã«ã“ã™ã‚Šã¤ã‘ã¦ã„ã¾ã™ã‹ï¼Ÿ',
    desc: 'ã‚«ãƒ¼ãƒšãƒƒãƒˆã‚„ã‚½ãƒ•ã‚¡ã«é¡”ã‚’æ“¦ã‚Šã¤ã‘ã‚‹ä»•è‰ãŒè¦‹ã‚‰ã‚Œã‚‹å ´åˆã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
    hint: null,
    label: 'é¡”ã‚„è€³ã‚’åºŠã‚„å®¶å…·ã«ã“ã™ã‚Šã¤ã‘ã‚‹'
  },
  {
    category: 'APPEARANCE',
    title: 'çš®è†šã«èµ¤ã¿ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ',
    desc: 'ãŠè…¹ã€è„‡ã€å†…è‚¡ã€è€³ã®å†…å´ãªã©ã€çš®è†šãŒèµ¤ããªã£ã¦ã„ã‚‹éƒ¨åˆ†ãŒã‚ã‚‹å ´åˆã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
    hint: 'æ¯›ã‚’ã‹ãåˆ†ã‘ã¦çš®è†šã®è‰²ã‚’ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ã€‚',
    label: 'çš®è†šã«èµ¤ã¿ãŒã‚ã‚‹'
  },
  {
    category: 'APPEARANCE',
    title: 'ã¶ã¤ã¶ã¤ãƒ»ã‹ã•ã¶ãŸãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ',
    desc: 'å°ã•ãªèµ¤ã„ã¶ã¤ã¶ã¤ã‚„ã€ã‹ã•ã¶ãŸã®ã‚ˆã†ãªã‚‚ã®ãŒè¦‹ã‚‰ã‚Œã‚‹å ´åˆã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
    hint: null,
    label: 'ã¶ã¤ã¶ã¤ãƒ»ã‹ã•ã¶ãŸãŒã‚ã‚‹'
  },
  {
    category: 'APPEARANCE',
    title: 'æ¯›ãŒéƒ¨åˆ†çš„ã«æŠœã‘ã¦ã„ã¾ã™ã‹ï¼Ÿ',
    desc: 'ä¸€éƒ¨ã ã‘æ¯›ãŒè–„ã„ã€å††å½¢ã«æŠœã‘ã¦ã„ã‚‹ã€ãªã©ã®å ´åˆã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
    hint: 'æ›æ¯›æœŸã®å…¨ä½“çš„ãªæŠœã‘æ¯›ã§ã¯ãªãã€éƒ¨åˆ†çš„ãªè„±æ¯›ãŒå¯¾è±¡ã§ã™ã€‚',
    label: 'æ¯›ãŒéƒ¨åˆ†çš„ã«æŠœã‘ã¦ã„ã‚‹'
  },
  {
    category: 'APPEARANCE',
    title: 'çš®è†šãŒé»’ãšã‚“ã§ã„ã‚‹ãƒ»ã‚´ãƒ¯ã‚´ãƒ¯ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ',
    desc: 'çš®è†šã®è‰²ãŒé»’ã£ã½ãå¤‰åŒ–ã—ã¦ã„ãŸã‚Šã€åšãç¡¬ããªã£ã¦ã„ã‚‹éƒ¨åˆ†ãŒã‚ã‚‹å ´åˆã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
    hint: 'è„‡ã®ä¸‹ã‚„è‚¡ã®å†…å´ã«å‡ºã‚„ã™ã„ç—‡çŠ¶ã§ã™ã€‚',
    label: 'çš®è†šãŒé»’ãšã‚“ã§ã„ã‚‹ãƒ»ã‚´ãƒ¯ã‚´ãƒ¯ã—ã¦ã„ã‚‹'
  },
  {
    category: 'APPEARANCE',
    title: 'ãƒ•ã‚±ãŒå¤šã„ã§ã™ã‹ï¼Ÿ',
    desc: 'ç™½ã„ç²‰ã®ã‚ˆã†ãªãƒ•ã‚±ãŒç›®ç«‹ã¤å ´åˆã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
    hint: null,
    label: 'ãƒ•ã‚±ãŒå¤šã„'
  },
  {
    category: 'APPEARANCE',
    title: 'ãƒ™ã‚¿ã¤ããƒ»ä½“è‡­ãŒæ°—ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ',
    desc: 'è¢«æ¯›ãŒãƒ™ã‚¿ã¤ãã€ã„ã¤ã‚‚ã¨é•ã†ä½“è‡­ãŒã™ã‚‹å ´åˆã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
    hint: 'ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼å¾Œã™ãã«ãƒ™ã‚¿ã¤ãå ´åˆã¯è¦ãƒã‚§ãƒƒã‚¯ã§ã™ã€‚',
    label: 'ãƒ™ã‚¿ã¤ããƒ»ä½“è‡­ãŒæ°—ã«ãªã‚‹'
  },
  {
    category: 'EAR',
    title: 'è€³ã‚’ã‚ˆãæŒ¯ã‚‹ãƒ»æ»ãã€è€³å¢ãŒã¹ãŸã¤ãã¾ã™ã‹ï¼Ÿ',
    desc: 'é ­ã‚’ã‚ˆãæŒ¯ã‚‹ã€è€³ã‚’å¾Œã‚è¶³ã§æ»ãã€è€³å¢ãŒèŒ¶è‰²ãã¹ãŸã¤ãå ´åˆã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
    hint: 'è€³ã®çš®è†šãƒˆãƒ©ãƒ–ãƒ«ã¯å¤–è€³ç‚ã®ã‚µã‚¤ãƒ³ã§ã‚ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚',
    label: 'è€³ã‚’ã‚ˆãæŒ¯ã‚‹ãƒ»æ»ããƒ»è€³å¢ãŒã¹ãŸã¤ã'
  }
];

// â”€â”€â”€ State â”€â”€â”€
let currentQ = 0;
let answers = [];
let petName = '';
let petPhotoDataURL = null;

// â”€â”€â”€ Navigation â”€â”€â”€
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
  const screen = document.getElementById(id);
  screen.classList.remove('hidden');
  screen.style.animation = 'none';
  screen.offsetHeight;
  screen.style.animation = '';
}

function updatePaws() {
  const paws = document.querySelectorAll('#pawTrack .paw');
  paws.forEach((p, i) => {
    if (i < currentQ) {
      if (!p.classList.contains('filled')) {
        p.classList.add('filled');
      }
    } else {
      p.classList.remove('filled');
    }
  });
}

function startCheck() {
  currentQ = 0;
  answers = [];
  // Reset paws
  document.querySelectorAll('#pawTrack .paw').forEach(p => p.classList.remove('filled'));
  document.getElementById('pawDone').classList.remove('show');
  document.getElementById('progressWrap').classList.remove('hidden');
  showQuestion();
}

function showQuestion() {
  const q = questions[currentQ];
  document.getElementById('qCategory').textContent = q.category;
  document.getElementById('qTitle').textContent = q.title;
  document.getElementById('qDesc').textContent = q.desc;

  const hintEl = document.getElementById('qHint');
  if (q.hint) {
    document.getElementById('qHintText').textContent = q.hint;
    hintEl.classList.remove('hidden');
  } else {
    hintEl.classList.add('hidden');
  }

  showScreen('screenQuestion');
  updatePaws();
}

// â”€â”€â”€ Particles â”€â”€â”€
const PARTICLE_COLORS = ['#C55E56', '#965D57', '#CDA094', '#EBD5CD', '#5A3C37'];

function spawnParticles() {
  const container = document.getElementById('particleContainer');
  const count = 14;
  const spread = 120;
  const maxSize = 8;
  const duration = 0.8;

  // Spawn from center of viewport
  const cx = window.innerWidth / 2;
  const cy = window.innerHeight / 2 + 60;

  for (let i = 0; i < count; i++) {
    const el = document.createElement('div');
    el.className = 'particle';

    const size = Math.random() * maxSize + 3;
    const tx = (Math.random() - 0.5) * spread * 2;
    const ty = (Math.random() - 0.7) * spread * 2;
    const rot = (Math.random() - 0.5) * 720;
    const d = duration + Math.random() * 0.3;
    const delay = Math.random() * 0.1;
    const color = PARTICLE_COLORS[Math.floor(Math.random() * PARTICLE_COLORS.length)];

    el.style.width = size + 'px';
    el.style.height = size + 'px';
    el.style.background = color;
    el.style.left = cx + 'px';
    el.style.top = cy + 'px';
    el.style.setProperty('--tx', tx + 'px');
    el.style.setProperty('--ty', ty + 'px');
    el.style.setProperty('--rot', rot + 'deg');
    el.style.setProperty('--duration', d + 's');
    el.style.animationDelay = delay + 's';

    container.appendChild(el);
    setTimeout(() => el.remove(), (d + delay) * 1000 + 100);
  }
}

function answer(isYes) {
  // Particles first
  spawnParticles();

  answers.push(isYes);
  currentQ++;

  if (currentQ < questions.length) {
    setTimeout(() => showQuestion(), 250);
  } else {
    // Fill last paw and show done
    updatePaws();
    document.getElementById('pawDone').classList.add('show');
    setTimeout(() => showScreen('screenInput'), 400);
  }
}

// â”€â”€â”€ Photo â”€â”€â”€
function handlePhoto(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(ev) {
    const img = new Image();
    img.onload = function() {
      // Crop to square from center
      const size = Math.min(img.width, img.height);
      const sx = (img.width - size) / 2;
      const sy = (img.height - size) / 2;

      const canvas = document.createElement('canvas');
      const outputSize = 512; // good quality for card
      canvas.width = outputSize;
      canvas.height = outputSize;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, sx, sy, size, size, 0, 0, outputSize, outputSize);

      petPhotoDataURL = canvas.toDataURL('image/jpeg', 0.92);

      const area = document.getElementById('photoArea');
      area.classList.add('has-photo');
      document.getElementById('uploadPlaceholder').classList.add('hidden');

      const existing = area.querySelector('img');
      if (existing) existing.remove();

      const preview = document.createElement('img');
      preview.src = petPhotoDataURL;
      area.appendChild(preview);
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
}

// â”€â”€â”€ Card Generation â”€â”€â”€
function generateCards() {
  petName = document.getElementById('petNameInput').value.trim() || 'ãƒ¯ãƒ³ã¡ã‚ƒã‚“';

  const hitCount = answers.filter(a => a).length;
  const today = new Date();
  const dateStr = today.getFullYear() + '.' +
    String(today.getMonth() + 1).padStart(2, '0') + '.' +
    String(today.getDate()).padStart(2, '0');

  // --- Result title & message ---
  document.getElementById('resultTitle').textContent = petName + ' ã®ã‘ã‚“ã“ã†ã‚«ãƒ¼ãƒ‰';

  const msgEl = document.getElementById('resultMessage');
  if (hitCount === 0) {
    msgEl.innerHTML = '<p>ä»Šã®ã¨ã“ã‚æ°—ã«ãªã‚‹ã‚µã‚¤ãƒ³ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>å®šæœŸçš„ã«ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚ã’ã¦ãã ã•ã„ã­ã€‚</p>';
  } else {
    msgEl.innerHTML = '<p>æ°—ã«ãªã‚‹ã‚µã‚¤ãƒ³ãŒ <strong>' + hitCount + 'å€‹</strong> ã‚ã‚Šã¾ã—ãŸã€‚<br>ç—‡çŠ¶ãŒç¶šãã‚ˆã†ãªã‚‰ã€ä¸€åº¦ç£åŒ»å¸«ã«<br>ç›¸è«‡ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</p>';
  }

  // --- Front Card ---
  const frontPhoto = document.getElementById('cardFrontPhoto');
  if (petPhotoDataURL) {
    frontPhoto.innerHTML = '<img src="' + petPhotoDataURL + '">';
  } else {
    frontPhoto.textContent = 'ğŸ•';
  }
  document.getElementById('cardFrontName').textContent = petName;

  // --- Back Card ---
  const backPhoto = document.getElementById('cardBackPhoto');
  if (petPhotoDataURL) {
    backPhoto.innerHTML = '<img src="' + petPhotoDataURL + '">';
  } else {
    backPhoto.textContent = 'ğŸ•';
  }
  document.getElementById('cardBackName').textContent = petName;
  document.getElementById('cardBackDate').textContent = dateStr;

  const bodyEl = document.getElementById('cardBackBody');

  if (hitCount === 0) {
    bodyEl.innerHTML = `
      <div class="all-clear">
        <div class="all-clear-check">âœ”</div>
        <div class="all-clear-text">ãƒã‚§ãƒƒã‚¯æ¸ˆã¿<br>æ°—ã«ãªã‚‹ã‚µã‚¤ãƒ³ã¯<br>è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>
      </div>`;
  } else {
    let html = '<div class="checklist-label">ãƒã‚§ãƒƒã‚¯é …ç›®</div>';
    questions.forEach((q, i) => {
      const hit = answers[i];
      html += `
        <div class="check-item">
          <div class="check-icon ${hit ? 'hit' : 'clear'}">${hit ? 'âœ”' : 'â€“'}</div>
          <div class="check-text ${hit ? '' : 'dimmed'}">${q.label}</div>
        </div>`;
    });
    bodyEl.innerHTML = html;
  }

  showScreen('screenResult');
}

// â”€â”€â”€ Share / Download â”€â”€â”€
async function shareCard(elementId, suffix) {
  const el = document.getElementById(elementId);
  if (typeof html2canvas === 'undefined') {
    alert('ç”»åƒç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™ã€‚å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
    return;
  }

  const bgColor = elementId === 'cardFront' ? '#C55E56' : '#FAFAF6';
  const name = (petName || 'card') + '_' + suffix + '.png';

  try {
    const canvas = await html2canvas(el, {
      scale: 3,
      useCORS: true,
      backgroundColor: bgColor,
      logging: false
    });

    // Convert canvas to blob
    const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
    const file = new File([blob], name, { type: 'image/png' });

    // Try Web Share API (iOS Safari â†’ å…±æœ‰ã‚·ãƒ¼ãƒˆ â†’ å†™çœŸã‚¢ãƒ—ãƒªã«ä¿å­˜å¯èƒ½)
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      await navigator.share({
        files: [file],
        title: petName + ' ã®ã‘ã‚“ã“ã†ã‚«ãƒ¼ãƒ‰'
      });
    } else {
      // Fallback: é€šå¸¸ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆPCç­‰ï¼‰
      const link = document.createElement('a');
      link.download = name;
      link.href = canvas.toDataURL('image/png');
      link.click();
    }
  } catch (err) {
    // User cancelled share â†’ do nothing
    if (err.name === 'AbortError') return;
    console.error('Share/Download error:', err);
    alert('ç”»åƒã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ã®ä¿å­˜ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚');
  }
}

// â”€â”€â”€ Restart â”€â”€â”€
function restart() {
  currentQ = 0;
  answers = [];
  petName = '';
  petPhotoDataURL = null;

  document.getElementById('petNameInput').value = '';
  const area = document.getElementById('photoArea');
  area.classList.remove('has-photo');
  const existingImg = area.querySelector('img');
  if (existingImg) existingImg.remove();
  document.getElementById('uploadPlaceholder').classList.remove('hidden');
  document.getElementById('photoInput').value = '';

  document.getElementById('progressWrap').classList.add('hidden');
  document.querySelectorAll('#pawTrack .paw').forEach(p => p.classList.remove('filled'));
  document.getElementById('pawDone').classList.remove('show');
  showScreen('screenIntro');
}
</script>

</body>
</html>
